<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Text-to-MIDI with Visual Highlighting - Demo</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .demo-container {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        .demo-header {
            text-align: center;
            margin-bottom: 30px;
        }
        
        .demo-header h1 {
            color: #333;
            margin: 0;
            font-size: 2.5em;
        }
        
        .demo-header p {
            color: #666;
            font-size: 1.1em;
            margin: 10px 0;
        }
        
        .quick-demo {
            display: grid;
            grid-template-columns: 1fr auto;
            gap: 20px;
            align-items: center;
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 20px;
        }
        
        .quick-demo textarea {
            width: 100%;
            min-height: 100px;
            padding: 15px;
            border: 2px solid #e0e0e0;
            border-radius: 6px;
            font-size: 16px;
            resize: vertical;
        }
        
        .quick-demo button {
            padding: 15px 30px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 6px;
            font-size: 16px;
            cursor: pointer;
            white-space: nowrap;
        }
        
        .quick-demo button:hover {
            background: #0056b3;
        }
        
        .demo-features {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 15px;
            margin: 20px 0;
        }
        
        .feature-card {
            background: #f1f3f4;
            padding: 15px;
            border-radius: 6px;
            border-left: 4px solid #007bff;
        }
        
        .feature-card h3 {
            margin: 0 0 8px 0;
            color: #333;
        }
        
        .feature-card p {
            margin: 0;
            color: #666;
            font-size: 14px;
        }
        
        .status-indicator {
            display: inline-block;
            width: 12px;
            height: 12px;
            border-radius: 50%;
            margin-right: 8px;
        }
        
        .status-indicator.ready { background: #28a745; }
        .status-indicator.loading { background: #ffc107; }
        .status-indicator.error { background: #dc3545; }
        
        @media (max-width: 768px) {
            .quick-demo {
                grid-template-columns: 1fr;
            }
        }
    </style>
    
    <!-- Include Tone.js -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tone/14.7.77/Tone.js"></script>
</head>
<body>
    <div class="demo-container">
        <div class="demo-header">
            <h1>üéµ Text-to-MIDI com Destaque Visual</h1>
            <p>Converta texto em m√∫sica com an√°lise lingu√≠stica avan√ßada e indica√ß√£o visual em tempo real</p>
        </div>
        
        <div class="quick-demo">
            <textarea id="demoText" placeholder="Digite um texto em portugu√™s para converter em m√∫sica...">Que bela manh√£ de sol! Como est√° o tempo hoje? Muito alegre, n√£o √©?</textarea>
            <button id="demoPlayButton">üéµ Reproduzir</button>
        </div>
        
        <div class="demo-features">
            <div class="feature-card">
                <h3><span class="status-indicator" id="audioStatus"></span>Sistema de √Åudio</h3>
                <p>Web Audio API com Tone.js para s√≠ntese musical em tempo real</p>
            </div>
            
            <div class="feature-card">
                <h3><span class="status-indicator" id="linguisticStatus"></span>An√°lise Lingu√≠stica</h3>
                <p>Processamento gramatical, fon√©tico e pros√≥dico do portugu√™s brasileiro</p>
            </div>
            
            <div class="feature-card">
                <h3><span class="status-indicator" id="highlightStatus"></span>Destaque Visual</h3>
                <p>Indica√ß√£o visual sincronizada de qual parte do texto est√° tocando</p>
            </div>
            
            <div class="feature-card">
                <h3><span class="status-indicator" id="integrationStatus"></span>Integra√ß√£o</h3>
                <p>Sistema integrado funcionando com todos os componentes</p>
            </div>
        </div>
        
        <div id="systemInfo" style="background: #e3f2fd; padding: 15px; border-radius: 6px; margin-top: 20px; font-family: monospace; font-size: 12px;"></div>
    </div>
    
    <script>
        // System status tracking
        let systemReady = false;
        let audioReady = false;
        let linguisticReady = false;
        let highlightReady = false;
        
        function updateStatus() {
            // Audio status
            const audioStatus = document.getElementById('audioStatus');
            if (typeof Tone !== 'undefined' && audioReady) {
                audioStatus.className = 'status-indicator ready';
            } else if (typeof Tone !== 'undefined') {
                audioStatus.className = 'status-indicator loading';
            } else {
                audioStatus.className = 'status-indicator error';
            }
            
            // Linguistic status
            const linguisticStatus = document.getElementById('linguisticStatus');
            if (typeof LinguisticIntegration !== 'undefined' && linguisticReady) {
                linguisticStatus.className = 'status-indicator ready';
            } else if (typeof LinguisticIntegration !== 'undefined') {
                linguisticStatus.className = 'status-indicator loading';
            } else {
                linguisticStatus.className = 'status-indicator error';
            }
            
            // Highlight status
            const highlightStatus = document.getElementById('highlightStatus');
            if (typeof TextHighlighter !== 'undefined' && highlightReady) {
                highlightStatus.className = 'status-indicator ready';
            } else if (typeof TextHighlighter !== 'undefined') {
                highlightStatus.className = 'status-indicator loading';
            } else {
                highlightStatus.className = 'status-indicator error';
            }
            
            // Integration status
            const integrationStatus = document.getElementById('integrationStatus');
            if (systemReady && audioReady && linguisticReady && highlightReady) {
                integrationStatus.className = 'status-indicator ready';
            } else if (systemReady) {
                integrationStatus.className = 'status-indicator loading';
            } else {
                integrationStatus.className = 'status-indicator error';
            }
            
            // Update system info
            const systemInfo = document.getElementById('systemInfo');
            systemInfo.innerHTML = `
                <strong>Status do Sistema:</strong><br>
                ‚Ä¢ Tone.js: ${typeof Tone !== 'undefined' ? '‚úì Carregado' : '‚úó N√£o encontrado'}<br>
                ‚Ä¢ LinguisticIntegration: ${typeof LinguisticIntegration !== 'undefined' ? '‚úì Dispon√≠vel' : '‚úó N√£o carregado'}<br>
                ‚Ä¢ TextHighlighter: ${typeof TextHighlighter !== 'undefined' ? '‚úì Dispon√≠vel' : '‚úó N√£o carregado'}<br>
                ‚Ä¢ AudioManager: ${typeof AudioManager !== 'undefined' ? '‚úì Dispon√≠vel' : '‚úó N√£o carregado'}<br>
                ‚Ä¢ √Åudio Inicializado: ${audioReady ? '‚úì Sim' : '‚úó N√£o'}<br>
                ‚Ä¢ Sistema Pronto: ${systemReady ? '‚úì Sim' : '‚úó N√£o'}
            `;
        }
        
        async function initializeDemo() {
            console.log('üöÄ Inicializando demo...');
            
            try {
                // Initialize audio
                if (typeof Tone !== 'undefined') {
                    await Tone.start();
                    audioReady = true;
                    console.log('‚úì √Åudio inicializado');
                }
                
                // Initialize linguistic integration
                if (typeof LinguisticIntegration !== 'undefined') {
                    LinguisticIntegration.setAnalysisMode('COMPLETE');
                    LinguisticIntegration.setDialect('carioca');
                    linguisticReady = true;
                    console.log('‚úì An√°lise lingu√≠stica inicializada');
                }
                
                // Initialize text highlighter
                if (typeof TextHighlighter !== 'undefined') {
                    // Create a simple text display for the demo
                    const textDisplay = document.createElement('div');
                    textDisplay.id = 'demoTextDisplay';
                    textDisplay.style.cssText = `
                        min-height: 60px;
                        padding: 15px;
                        border: 2px solid #e0e0e0;
                        border-radius: 6px;
                        background: #fafafa;
                        margin: 15px 0;
                        font-size: 18px;
                        line-height: 1.6;
                        display: none;
                    `;
                    document.querySelector('.quick-demo').after(textDisplay);
                    
                    TextHighlighter.initialize(textDisplay);
                    TextHighlighter.setHighlightMode('word');
                    highlightReady = true;
                    console.log('‚úì Sistema de destaque inicializado');
                }
                
                systemReady = true;
                console.log('‚úÖ Demo pronta para uso!');
                
            } catch (error) {
                console.error('‚ùå Erro na inicializa√ß√£o:', error);
            }
            
            updateStatus();
        }
        
        async function playDemo() {
            const text = document.getElementById('demoText').value.trim();
            const button = document.getElementById('demoPlayButton');
            const textDisplay = document.getElementById('demoTextDisplay');
            
            if (!text) {
                alert('Digite um texto para reproduzir!');
                return;
            }
            
            if (!systemReady) {
                button.textContent = '‚è≥ Inicializando...';
                button.disabled = true;
                await initializeDemo();
                button.disabled = false;
            }
            
            try {
                if (Tone.Transport.state === 'started') {
                    // Stop playback
                    Tone.Transport.stop();
                    Tone.Transport.cancel();
                    if (typeof TextHighlighter !== 'undefined') {
                        TextHighlighter.stopHighlighting();
                    }
                    if (textDisplay) textDisplay.style.display = 'none';
                    button.textContent = 'üéµ Reproduzir';
                    return;
                }
                
                // Start playback
                button.textContent = '‚è∏Ô∏è Parar';
                if (textDisplay) {
                    textDisplay.style.display = 'block';
                    textDisplay.style.border = '2px solid #007bff';
                }
                
                // Process with linguistic integration
                if (typeof LinguisticIntegration !== 'undefined') {
                    const result = LinguisticIntegration.processText(text, 'pentatonic_major');
                    
                    // Prepare highlighting
                    if (typeof TextHighlighter !== 'undefined') {
                        TextHighlighter.prepareText(text, result);
                    }
                    
                    // Create simple synth and schedule playback
                    const synth = new Tone.Synth().toDestination();
                    let currentTime = 0;
                    
                    // Start highlighting
                    if (typeof TextHighlighter !== 'undefined') {
                        TextHighlighter.startHighlighting(result);
                    }
                    
                    result.finalSequence.forEach((noteData, index) => {
                        if (noteData.note) {
                            Tone.Transport.scheduleOnce((time) => {
                                synth.triggerAttackRelease(
                                    noteData.note, 
                                    noteData.duration || '8n', 
                                    time, 
                                    noteData.velocity || 0.5
                                );
                            }, currentTime);
                            
                            currentTime += Tone.Time(noteData.duration || '8n').toSeconds();
                        } else {
                            currentTime += Tone.Time('16n').toSeconds();
                        }
                    });
                    
                    // Schedule cleanup
                    Tone.Transport.scheduleOnce(() => {
                        button.textContent = 'üéµ Reproduzir';
                        if (textDisplay) {
                            textDisplay.style.display = 'none';
                            textDisplay.style.border = '2px solid #e0e0e0';
                        }
                        console.log('‚úÖ Reprodu√ß√£o finalizada');
                    }, currentTime);
                    
                    Tone.Transport.start();
                    console.log(`üéµ Reproduzindo: ${result.finalSequence.length} elementos`);
                    
                } else {
                    // Simple fallback
                    alert('Sistema de an√°lise lingu√≠stica n√£o dispon√≠vel. Carregue todos os m√≥dulos.');
                }
                
            } catch (error) {
                console.error('‚ùå Erro durante reprodu√ß√£o:', error);
                button.textContent = 'üéµ Reproduzir';
                alert('Erro durante a reprodu√ß√£o. Verifique o console.');
            }
        }
        
        // Event listeners
        document.getElementById('demoPlayButton').addEventListener('click', playDemo);
        
        // Initialize on first click
        document.addEventListener('click', initializeDemo, { once: true });
        
        // Initial status
        updateStatus();
        console.log('üìã Demo carregado. Clique para inicializar o √°udio.');
    </script>
    
    <!-- Load application modules if available -->
    <script>
        // Try to load modules if they exist
        const modules = [
            'js/config.js',
            'js/grammar.js',
            'js/musical-grammar.js', 
            'js/harmonic-engine.js',
            'js/phonetic-engine.js',
            'js/stress-analyzer.js',
            'js/prosodic-engine.js',
            'js/linguistic-integration.js',
            'js/text-highlighter.js',
            'js/audio.js'
        ];
        
        modules.forEach(src => {
            const script = document.createElement('script');
            script.src = src;
            script.onerror = () => console.log(`‚ö†Ô∏è M√≥dulo n√£o encontrado: ${src}`);
            script.onload = () => console.log(`‚úì M√≥dulo carregado: ${src}`);
            document.head.appendChild(script);
        });
    </script>
</body>
</html>