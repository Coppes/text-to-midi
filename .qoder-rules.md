# Text-to-MIDI Project Rules for Qoder IDE

## 1. PROJECT OVERVIEW

**Project Name:** Text-to-MIDI Experimental Website  
**Primary Goal:** Create an experimental website that converts user-typed text into real-time MIDI music  
**Architecture:** Single-page web application with client-side processing  

## 2. TECHNOLOGY STACK RULES

### Core Technologies (MANDATORY)
- **Frontend:** HTML5, CSS3, Vanilla JavaScript (ES6+) - NO UI frameworks
- **Audio Library:** Tone.js (latest stable version) - MANDATORY for all audio operations
- **Development Server:** http-server (v14.1.1) for local development
- **Build Tool:** None required - pure static files

### Forbidden Technologies
- **UI Frameworks:** React, Vue, Angular, or any other UI framework
- **Build Tools:** Webpack, Vite, Parcel (keep it simple)
- **Backend:** No server-side processing allowed
- **Other Audio Libraries:** Web Audio API direct usage (use Tone.js wrapper)

## 3. PROJECT STRUCTURE RULES

### File Organization (STRICT)
```
text-to-midi/
├── index.html            # Main page structure
├── style.css             # All visual styles
├── js/                   # JavaScript modules
│   ├── main.js          # Application orchestration & global event listeners
│   ├── ui.js            # UI creation & manipulation functions
│   ├── audio.js         # Tone.js logic & MIDI handling
│   └── config.js        # Static configurations & mappings
├── package.json         # Development dependencies only
├── dev.md              # Developer documentation
└── roadmap.md          # Implementation roadmap
```

### Module Responsibilities (MANDATORY)

#### main.js
- Application initialization and orchestration
- Global state management (current text, selected configurations)
- Event coordination between ui.js and audio.js
- URL state handling for sharing functionality
- NO direct DOM manipulation (delegate to ui.js)
- NO direct audio operations (delegate to audio.js)

#### ui.js
- ALL DOM element creation and manipulation
- UI component event handlers (buttons, sliders, dropdowns)
- Visual feedback and state updates
- NO audio logic
- NO application state management

#### audio.js
- ALL Tone.js operations and audio logic
- Instrument loading and management
- Note sequencing and playback
- Audio effects (EQ, modulation) application
- NO DOM manipulation
- NO UI state management

#### config.js
- Musical scales definitions and note mappings
- Instrument configurations and presets
- Default parameter values
- Static data only - NO functions or logic

## 4. CODING STANDARDS

### JavaScript Standards
- **ES6+ Features:** Use modern JavaScript (const/let, arrow functions, destructuring)
- **Function Style:** Prefer pure functions where possible
- **Naming Convention:** camelCase for variables/functions, PascalCase for classes
- **Comments:** Document complex logic and design decisions
- **Error Handling:** Always handle Tone.js async operations properly

### Code Quality Rules
- **Single Responsibility:** Each function should have one clear purpose
- **Modularity:** Keep modules loosely coupled
- **Constants:** Define magic numbers and strings in config.js
- **No Global Variables:** Use module pattern for state management

### Audio-Specific Rules
- **Tone.js Context:** Always ensure audio context is started properly
- **Memory Management:** Dispose of audio nodes when not needed
- **Performance:** Limit simultaneous audio nodes for browser performance
- **Browser Compatibility:** Test audio features across modern browsers

## 5. DEVELOPMENT WORKFLOW

### Setup Requirements
1. Node.js and npm installed
2. Install dependencies: `npm install`
3. Start development server: `npm start`
4. Access application at: `http://localhost:8080`

### Code Changes Protocol
1. **Before Implementation:** Update roadmap.md if adding new features
2. **During Development:** Follow modular architecture strictly
3. **Testing:** Manual testing across different browsers
4. **Documentation:** Update dev.md for significant changes

### Git Workflow
- **Commit Frequency:** Small, focused commits
- **Commit Messages:** Clear, descriptive messages
- **Branching:** Feature branches for major additions
- **Code Review:** Self-review before committing

## 6. FEATURE IMPLEMENTATION RULES

### Core Features (Phase 2)
- Text input with real-time audio feedback
- Basic piano instrument with C Major scale
- Play/Pause functionality for full text sequence
- Minimal UI with textarea and controls

### Extended Features (Phase 3)
- Multiple musical scales (dropdown selection)
- Multiple MIDI instruments (dropdown selection)
- Audio parameter controls (EQ and modulation sliders)
- Enhanced UI with visual feedback

### Advanced Features (Phase 4)
- URL-based sharing with state encoding
- State restoration from shared URLs
- Enhanced audio effects and instruments

### Future Features (Phase 5)
- Advanced musical theory implementations
- Recording and export capabilities
- Improved UI/UX with animations
- Mobile responsiveness

## 7. PERFORMANCE GUIDELINES

### Audio Performance
- **Latency:** Minimize audio latency for real-time feedback
- **Memory:** Dispose of unused audio nodes promptly
- **CPU:** Limit concurrent audio processing
- **Buffer Size:** Optimize for low-latency audio

### Web Performance
- **Loading:** Keep initial bundle size minimal
- **Caching:** Leverage browser caching for audio samples
- **Responsive:** Ensure smooth UI interactions
- **Memory Leaks:** Prevent DOM and audio node memory leaks

## 8. TESTING REQUIREMENTS

### Manual Testing Checklist
- **Cross-Browser:** Chrome, Firefox, Safari, Edge
- **Audio Functionality:** All instruments and scales
- **UI Responsiveness:** All interactive elements
- **State Management:** Sharing and restoration features
- **Performance:** No audio dropouts or UI lag

### Error Scenarios
- **Audio Context Issues:** Graceful handling of audio failures
- **Invalid Input:** Handle special characters in text input
- **URL Sharing:** Validate shared state parameters
- **Browser Compatibility:** Fallbacks for unsupported features

## 9. SECURITY AND PRIVACY

### Client-Side Security
- **Input Validation:** Sanitize text input for XSS prevention
- **URL Parameters:** Validate shared state data
- **Audio Context:** Handle user gesture requirements properly
- **No Data Collection:** Ensure no user data is transmitted

## 10. DOCUMENTATION REQUIREMENTS

### Code Documentation
- **Function Comments:** Document public functions and complex logic
- **Module Headers:** Describe module purpose and dependencies
- **Configuration:** Document all config.js parameters
- **Architecture Decisions:** Record significant design choices in dev.md

### User Documentation
- **README:** Clear setup and usage instructions
- **Feature Guide:** Document all user-facing features
- **Browser Support:** List supported browsers and requirements
- **Troubleshooting:** Common issues and solutions

## 11. QUALITY ASSURANCE

### Code Review Checklist
- [ ] Follows modular architecture
- [ ] Proper error handling for audio operations
- [ ] No cross-module responsibility violations
- [ ] Performance considerations addressed
- [ ] Documentation updated
- [ ] Manual testing completed

### Definition of Done
- Feature implemented according to specifications
- Code follows all project rules and standards
- Manual testing completed successfully
- Documentation updated
- No performance regressions
- Compatible with target browsers

---

**Last Updated:** [Current Date]  
**Version:** 1.0  
**Next Review:** After Phase 2 completion